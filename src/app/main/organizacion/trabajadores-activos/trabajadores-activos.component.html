<div class="flex flex-col h-full">
  <div class="flex flex-col justify-center gap-4 px-6 py-4">
    <div class="flex justify-between items-center gap-4">
      <title-card [title]="title" [icon]="icon" />
    </div>
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-2">
        <div class="w-42">
          <p-multiselect
            [options]="listaSedes"
            [(ngModel)]="selectedSedes"
            optionLabel="nombre"
            optionValue="id"
            placeholder="Edificios"
            [maxSelectedLabels]="2"
            styleClass="w-42"
            pTooltip="Edificios"
            tooltipPosition="top"
            tooltipStyleClass="text-sm"
          />
        </div>
        <div class="w-42">
          <p-multiselect
            [options]="listaCargos"
            [(ngModel)]="selectedCargos"
            optionLabel="nombre"
            optionValue="id"
            placeholder="Cargos"
            [maxSelectedLabels]="2"
            styleClass="w-42"
            class="w-42"
            pTooltip="Cargos"
            tooltipPosition="top"
            tooltipStyleClass="text-sm"
          />
        </div>
        <input pInputText [(ngModel)]="searchText" placeholder="Buscar" />
        <p-button
          severity="contrast"
          variant="outlined"
          size="small"
          (click)="search()"
        >
          <div class="flex justify-center items-center gap-2">
            <div>Filtrar</div>
          </div>
        </p-button>
        <p-button
          severity="danger"
          variant="outlined"
          size="small"
          (click)="clear()"
        >
          <div class="flex justify-center items-center gap-2">
            <div>Limpiar</div>
          </div>
        </p-button>
      </div>
      <div class="flex items-center gap-2">
        <div class="flex justify-end" *ngIf="isSuper">
          <input
            #fileImage
            class="hidden"
            type="file"
            (change)="onExcelSelected($event)"
            accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
          />
          <btn-add
            severity="contrast"
            label="Carga masiva"
            icon="bx:upload"
            (onClick)="precargarCargaMasiva(fileImage)"
          />
        </div>
        <btn-add (onClick)="addNew()" />
      </div>
    </div>
  </div>
  <div class="flex flex-col px-6">
    <p-table
      dataKey="id"
      [value]="dataTable"
      [columns]="cols"
      stripedRows
      [scrollable]="true"
      scrollHeight="calc(100vh - 220px)"
      styleClass="w-full"
    >
      <ng-template #header let-columns>
        <tr>
          <th
            *ngFor="let col of columns"
            [ngClass]="[col.widthClass ? col.widthClass : '']"
          >
            <div [ngClass]="[col.align ? 'text-' + col.align : 'text-start']">
              {{ col.header }}
            </div>
          </th>
        </tr>
      </ng-template>
      <ng-template #body let-item>
        <tr>
          <td>
            <div class="text-center text-sm">{{ item.identificacion }}</div>
          </td>
          <td>
            <div class="text-sm uppercase">{{ item.labelName }}</div>
          </td>
          <td>
            <div class="text-center text-sm uppercase">
              {{ item.contratos[0]?.cargo?.nombre }}
            </div>
          </td>
          <td>
            <tags-sedes [sedes]="item.sedes" />
          </td>
          <td>
            <!-- <div class="text-center text-sm">
              {{ item.contratos[0]?.tiempoContrato?.nombre }}
            </div> -->
            <div class="flex justify-center items-center">
              <div
                *ngIf="item.biometricos[0].urlFile"
                class="border border-slate-300 rounded-lg w-20 h-20"
              >
                <p-image
                  loading="lazy"
                  [src]="getImageUrl(item.biometricos[0].urlFile)"
                  [alt]="item.labelName"
                  class="w-20 h-20 object-cover rounded-lg overflow-hidden"
                  [preview]="true"
                />
              </div>
              <div
                *ngIf="!item.biometricos[0].urlFile"
                class="flex flex-col justify-center"
              >
                <p class="text-xs text-center">CÃ³digo de registro</p>
                <p class="text-xl font-medium text-center">
                  {{ item.biometricos[0].codigo }}
                </p>
              </div>
            </div>
          </td>
          <td>
            <div class="text-center text-sm">
              {{
                item.contratos[0]?.fechaInicio
                  | date : "dd MMM yyyy"
                  | uppercase
              }}
            </div>
          </td>
          <td class="w-28">
            <div class="flex justify-center items-center gap-1">
              <btn-edit (onClick)="edit(item)" />
              <btn-delete (onClick)="remove(item)" />
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template #emptymessage>
        <ng-template
          [skeletonTable]="{
            loading: loadingTable,
            numCols: cols.length,
            numRows: 4
          }"
        ></ng-template>
      </ng-template>
      <ng-template #footer>
        <ng-template
          [appPaginator]="{
            totalItems: totalItems,
            limit: limit,
            offset: offset,
            pageChange: onPageChange
          }"
        ></ng-template>
      </ng-template>
    </p-table>
  </div>
</div>
