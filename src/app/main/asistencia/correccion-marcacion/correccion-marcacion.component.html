<div class="flex flex-col h-full">
  <div class="flex flex-col justify-center gap-4 px-6 py-4">
    <div class="flex justify-between items-center gap-4">
      <title-card [title]="title" [icon]="icon" />
    </div>
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <p-datepicker
          id="fechaInicio"
          view="month"
          dateFormat="MM yy"
          placeholder="Seleccionar mes"
          [(ngModel)]="fechaSelected"
          [readonlyInput]="true"
          showIcon
          iconDisplay="input"
          styleClass="w-44"
          appendTo="body"
          pTooltip="Mes"
          tooltipPosition="top"
          tooltipStyleClass="text-sm"
          (ngModelChange)="cambiarFecha($event)"
        />
        <p-multiselect
          [options]="listaSedes"
          [(ngModel)]="selectedSedes"
          optionLabel="nombre"
          optionValue="id"
          placeholder="Edificios"
          [maxSelectedLabels]="2"
          (onChange)="filtrar($event.value)"
          styleClass="w-42"
          pTooltip="Edificios"
          tooltipPosition="top"
          tooltipStyleClass="text-sm"
        />
        <p-multiselect
          [options]="listaCargos"
          [(ngModel)]="selectedCargos"
          optionLabel="nombre"
          optionValue="id"
          placeholder="Cargos"
          [maxSelectedLabels]="2"
          (onChange)="filtrar($event.value)"
          styleClass="w-42"
          pTooltip="Cargos"
          tooltipPosition="top"
          tooltipStyleClass="text-sm"
        />
        <p-iconfield>
          <p-inputicon styleClass="pi pi-search" />
          <input
            type="text"
            pInputText
            placeholder="Buscar"
            (input)="filterGlobal(dt1, $event.target)"
          />
        </p-iconfield>
      </div>
      <!-- <div class="flex items-center gap-3">
        <p-button severity="info" size="small">
          <div class="flex justify-center items-center font-medium gap-1">
            <i
              class="iconify icon text-lg"
              data-icon="material-symbols:download-rounded"
              data-inline="false"
            ></i>
            <div>XLS</div>
          </div>
        </p-button>
      </div> -->
    </div>
  </div>
  <div class="flex flex-col h-[calc(100% - 8.5rem)] px-6">
    <p-table
      #dt1
      dataKey="id"
      [value]="dataTable"
      stripedRows
      [scrollable]="true"
      scrollHeight="715px"
      styleClass="w-full"
      [globalFilterFields]="['nombre', 'apellido']"
    >
      <ng-template #header>
        <tr>
          <th rowspan="2">
            <div class="text-center text-xs uppercase">Fecha</div>
          </th>
          <th rowspan="2">
            <div class="text-xs uppercase">Apellidos y Nombre</div>
          </th>
          <th rowspan="2">
            <div class="text-center text-xs uppercase">Edificio</div>
          </th>
          <th rowspan="2">
            <div class="text-center text-xs uppercase">Cargo</div>
          </th>
          <th colspan="2">
            <div class="text-center text-xs uppercase">Horario</div>
          </th>
          <th colspan="2">
            <div class="text-center text-xs uppercase">Marcaci√≥n</div>
          </th>
          <th rowspan="2">
            <div class="text-center text-xs uppercase">Acciones</div>
          </th>
        </tr>
        <tr>
          <th>
            <div class="text-center text-xs uppercase">Entrada</div>
          </th>
          <th>
            <div class="text-center text-xs uppercase">Salida</div>
          </th>
          <th>
            <div class="text-center text-xs uppercase">Entrada</div>
          </th>
          <th>
            <div class="text-center text-xs uppercase">Salida</div>
          </th>
        </tr>
      </ng-template>
      <ng-template #body let-item let-i="rowIndex">
        <tr>
          <td>{{ item.fecha | date : "dd MMM yyyy" | uppercase }}</td>
          <td>{{ item.apellido }} {{ item.nombre }}</td>
          <td>{{ item.sede.nombre }}</td>
          <td>{{ item.cargo.nombre }}</td>

          <td class="!text-center !text-sm">
            <div class="flex justify-center">
              <div
                [ngClass]="[
                  'w-16 h-8 rounded-md flex items-center justify-center bg-slate-300'
                ]"
              >
                {{ item?.horario?.entrada | date : "HH:mm" }}
              </div>
            </div>
          </td>
          <td class="!text-center !text-sm">
            <div class="flex justify-center">
              <div
                [ngClass]="[
                  'w-16 h-8 rounded-md flex items-center justify-center bg-slate-300'
                ]"
              >
                {{ item?.horario?.salida | date : "HH:mm" }}
              </div>
            </div>
          </td>
          <td class="!text-center !text-sm">
            <div class="flex justify-center">
              <div
                [ngClass]="[
                  'w-16 h-8 rounded-md flex items-center justify-center',
                  item.horario?.entrada != item.asistencia?.marcacionEntrada
                    ? item.asistencia?.correccion
                      ? 'bg-green-400 text-slate-50'
                      : 'bg-red-100 border border-red-600 text-red-600'
                    : 'bg-slate-300'
                ]"
                [pTooltip]="
                  item.horario?.entrada != item.asistencia?.marcacionEntrada &&
                  item.asistencia?.correccion
                    ? 'Corregido'
                    : ''
                "
                tooltipPosition="top"
                tooltipStyleClass="text-xs"
              >
                {{
                  item.asistencia?.correccion
                    ? (item.asistencia?.correccion?.marcacionEntrada
                      | date : "HH:mm")
                    : !item.asistencia?.marcacionEntrada
                    ? "--:--"
                    : (item.asistencia?.marcacionEntrada | date : "HH:mm")
                }}
              </div>
            </div>
          </td>
          <td class="!text-center !text-sm">
            <div class="flex justify-center">
              <div
                [ngClass]="[
                  'w-16 h-8 rounded-md flex items-center justify-center',
                  item.horario?.salida != item.asistencia?.marcacionSalida
                    ? item.asistencia?.correccion
                      ? 'bg-green-100 border border-green-600 text-green-600'
                      : 'bg-red-100 border border-red-600 text-red-600'
                    : 'bg-slate-300'
                ]"
                [pTooltip]="
                  item.horario?.salida != item.asistencia?.marcacionSalida &&
                  item.asistencia?.correccion
                    ? 'Corregido'
                    : ''
                "
                tooltipPosition="top"
                tooltipStyleClass="text-xs"
              >
                {{
                  item.asistencia?.correccion
                    ? (item.asistencia?.correccion?.marcacionSalida
                      | date : "HH:mm")
                    : !item.asistencia?.marcacionSalida
                    ? "--:--"
                    : (item.asistencia?.marcacionSalida | date : "HH:mm")
                }}
              </div>
            </div>
          </td>
          <td>
            <div class="flex justify-center items-center gap-2">
              <p-button
                text
                (click)="editar(item)"
                severity="info"
                size="small"
                rounded
                styleClass="!w-10 !p-2"
                pTooltip="Corregir"
                tooltipPosition="top"
                tooltipStyleClass="!text-xs !font-normal !p-0"
              >
                <iconify-icon [icon]="'material-symbols:feature-search-outline-rounded'" class="text-xl" />
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template #emptymessage>
        <tr>
          <td colspan="100">
            <div class="text-center text-sm font-extralight">
              No se encontraron registros.
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
